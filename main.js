/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var f=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var B=(o,r)=>{for(var e in r)f(o,e,{get:r[e],enumerable:!0})},V=(o,r,e,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of N(r))!$.call(o,s)&&s!==e&&f(o,s,{get:()=>r[s],enumerable:!(t=D(r,s))||t.enumerable});return o};var _=o=>V(f({},"__esModule",{value:!0}),o);var F={};B(F,{default:()=>E});module.exports=_(F);var S=require("obsidian");var v={enableHtmlParsing:!0};var T=()=>(o,r="unknown")=>{console.debug(`[CardViewer] Error in ${r}:`,o.message)},M=async(o,r,e="unknown")=>{try{return await o()}catch(t){return r(t,e),null}};var P=class{parseCard(r,e){let t=i=>{let n=e.split(`
`);for(let l of n){let c=l.match(new RegExp(`^${i}:\\s*(.*)$`));if(c){let m=c[1].trim();return m.length>0?m:void 0}}},s=i=>{let n=t(i);return n?parseFloat(n):void 0},a=t("title");return{type:r||"unknown",title:a||"\u672A\u547D\u540D",id:t("id")||s("id"),release_date:t("release_date"),region:t("region"),rating:s("rating"),runtime:s("runtime"),genres:t("genres"),overview:t("overview"),poster:t("poster"),author:t("author"),album:t("album"),duration:s("duration"),url:t("url"),source:t("source"),external_url:t("external_url")}}},L=new P;var I=require("obsidian"),C=class{constructor(r){this.app=r}processImagePath(r){let e=r;try{e=decodeURIComponent(e)}catch(t){}if(e.startsWith("./")){let t=e.replace(/^\.\//,"");return this.getVaultResourcePath(t)||r}else if(e.startsWith("../")){let t=e.replace(/^\.\.\//,"");return this.getVaultResourcePath(t)||r}else if(e.startsWith("/")&&!e.startsWith("//")){let t=e.substring(1);return this.getVaultResourcePath(t)||r}else if(!e.startsWith("/")&&!e.startsWith("http://")&&!e.startsWith("https://")&&!e.startsWith("data:")&&!e.startsWith("blob:")&&!e.startsWith("file:"))return this.getVaultResourcePath(e)||r;return e}getVaultResourcePath(r){try{let e=this.app.vault.getAbstractFileByPath(r);if(e instanceof I.TFile)return this.app.vault.getResourcePath(e)}catch(e){console.warn(`Failed to get resource path for: ${r}`,e)}return null}};function p(o){return new C(o)}var x=class{constructor(r){this.app=r;this.imagePathProcessor=p(r)}async renderCard(r,e,t,s){if(!t||typeof t.createEl!="function")return;let a=L.parseCard(r,e);if(!a){t.createEl("div",{text:"Invalid card format"});return}let i=t.createEl("div",{cls:"card-viewer-card"}),n=i.createEl("div",{cls:"card-viewer-content"}),l=n.createEl("div",{cls:"card-viewer-poster-section"}),c=n.createEl("div",{cls:"card-viewer-info-section"});this.addCardClickHandler(i,a),this.renderCardHeader(c,a),this.renderRating(c,a),this.renderDetails(c,a),this.renderPoster(l,a),this.renderAdditionalInfo(c,a)}addCardClickHandler(r,e){(e.id||e.type==="music"&&e.url||e.external_url)&&(r.addClass("card-viewer-clickable"),r.addEventListener("click",t=>{if(t.preventDefault(),e.external_url){window.open(e.external_url,"_blank");return}if(e.type==="music"&&e.url)window.open(e.url,"_blank");else if(e.id){let s=this.getBaseUrl(e);window.open(`${s}${e.id}`,"_blank")}}))}getBaseUrl(r){return r.source==="douban"?r.type==="movie"||r.type==="tv"?"https://movie.douban.com/subject/":r.type==="book"?"https://book.douban.com/subject/":"https://movie.douban.com/subject/":r.type==="tv"?"https://www.themoviedb.org/tv/":r.type==="book"?"https://book.douban.com/subject/":"https://www.themoviedb.org/movie/"}renderCardHeader(r,e){let t=r.createEl("div",{cls:"card-viewer-header"}),s=t.createEl("h3",{text:e.title,cls:"card-viewer-title"});t.createEl("div",{cls:"card-viewer-header-right"}).createEl("span",{text:e.type.toUpperCase(),cls:`card-viewer-type card-viewer-type-${e.type}`})}renderRating(r,e){if(e.rating){let s=r.createEl("div",{cls:"card-viewer-meta"}).createEl("div",{cls:"card-viewer-rating"}),a=s.createEl("div",{cls:"card-viewer-stars"});this.renderStars(a,e.rating),s.createSpan({text:e.rating.toFixed(1),cls:"card-viewer-rating-text"})}}renderStars(r,e){let t=e/2;for(let s=0;s<5;s++){let a=s<Math.floor(t),i=s===Math.floor(t)&&t%1>=.5,n=r.createEl("span",{cls:`card-viewer-star ${a?"full":i?"half":"empty"}`}),l=document.createElementNS("http://www.w3.org/2000/svg","svg");if(l.setAttribute("viewBox","0 0 20 20"),l.setAttribute("fill","none"),i){let c=document.createElementNS("http://www.w3.org/2000/svg","defs"),m=document.createElementNS("http://www.w3.org/2000/svg","clipPath");m.setAttribute("id",`half-star-${s}`);let g=document.createElementNS("http://www.w3.org/2000/svg","rect");g.setAttribute("x","0"),g.setAttribute("y","0"),g.setAttribute("width","10"),g.setAttribute("height","20"),m.appendChild(g),c.appendChild(m),l.appendChild(c);let w=document.createElementNS("http://www.w3.org/2000/svg","path");w.setAttribute("d","M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"),w.setAttribute("fill","#d1d5db"),l.appendChild(w);let u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d","M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"),u.setAttribute("fill","#fbbf24"),u.setAttribute("clip-path",`url(#half-star-${s})`),l.appendChild(u)}else{let c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d","M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"),a?c.setAttribute("fill","#fbbf24"):c.setAttribute("fill","#d1d5db"),l.appendChild(c)}n.appendChild(l)}}renderDetails(r,e){let t=r.createEl("div",{cls:"card-viewer-details"});if(this.addDetail(t,"\u65E5\u671F",e.release_date),e.type==="music"){if(this.addDetail(t,"\u4F5C\u8005",e.author),this.addDetail(t,"\u4E13\u8F91",e.album),e.duration){let s=Math.floor(e.duration/60),a=e.duration%60;this.addDetail(t,"\u65F6\u957F",`${s}:${a.toString().padStart(2,"0")}`)}}else e.type==="book"?this.addDetail(t,"\u4F5C\u8005",e.author):(this.addDetail(t,"\u5730\u533A",e.region),e.runtime&&this.addDetail(t,"\u65F6\u957F",`${e.runtime}\u5206\u949F`))}renderPoster(r,e){if(e.poster){let t=this.imagePathProcessor.processImagePath(e.poster),s=r.createEl("div",{cls:"card-viewer-poster-container"}),a=s.createEl("img",{cls:"card-viewer-poster card-viewer-poster-image",attr:{src:t,alt:e.title||"\u6D77\u62A5\u56FE\u7247"}});a.onerror=()=>{a.addClass("card-viewer-poster-image hidden");let i=s.createEl("div",{cls:"card-viewer-poster-error"});i.createEl("div",{text:"\u{1F4F7}",cls:"card-viewer-error-icon"}),i.createEl("div",{text:"\u56FE\u7247\u52A0\u8F7D\u5931\u8D25",cls:"card-viewer-error-text"})},a.onload=()=>{a.addClass("loaded")}}else{let t=r.createEl("div",{cls:"card-viewer-poster-placeholder",text:"\u6682\u65E0\u56FE\u7247"})}}renderAdditionalInfo(r,e){let t=r.querySelector(".card-viewer-details");if(t&&(this.addDetail(t,"\u7C7B\u578B",e.genres,"genres"),e.overview)){let a=t.createEl("div",{cls:"card-viewer-overview"}).createEl("div",{text:e.overview,cls:"card-viewer-overview-text"})}}addDetail(r,e,t,s=""){if(t){let a=r.createEl("div",{cls:`card-viewer-detail ${s}`});if(a.createEl("span",{text:`${e}: `,cls:"card-viewer-label"}),s==="genres"){let i=a.createEl("div",{cls:"card-viewer-genres-container"});t.toString().split(/[,ï¼Œ]/).map(l=>l.trim()).filter(l=>l).forEach(l=>{l&&i.createEl("span",{text:l,cls:"card-viewer-genre-tag"})})}else a.createSpan({text:t.toString(),cls:"card-viewer-value"})}}},k=o=>new x(o);var b=class{constructor(r){this.app=r;this.imagePathProcessor=p(r)}async renderImgsGrid(r,e,t){try{let s=e.appendChild(document.createElement("div"));s.className="imgs-grid-header";let a=s.appendChild(document.createElement("span"));a.textContent="IMAGES",a.className="imgs-grid-type";let i=e.appendChild(document.createElement("div"));i.className="imgs-grid";let n=this.parseImages(r);n.length===0?this.renderEmptyPlaceholder(i):this.renderImages(i,n)}catch(s){let a=e.appendChild(document.createElement("div"));a.textContent=`\u56FE\u7247\u7F51\u683C\u6E32\u67D3\u5931\u8D25: ${s.message}`}}parseImages(r){let e=/!\[([^\]]*)\]\(([^\s\)]+)(?:\s+"([^"]+)")?\)/g,t=[],s;for(;(s=e.exec(r))!==null;)t.push({alt:s[1]||"",src:s[2],title:s[3]||""});return t}renderEmptyPlaceholder(r){let e=r.appendChild(document.createElement("div"));e.className="imgs-grid-placeholder",e.textContent="\u672A\u627E\u5230\u56FE\u7247"}renderImages(r,e){e.forEach((t,s)=>{let a=this.createImageItem(t,s);r.appendChild(a)})}createImageItem(r,e){let t=document.createElement("div");t.className="imgs-grid-item";let s=this.processImageSrc(r.src),a=this.createImageElement(t,s,r);return r.title&&this.addImageTitle(t,r.title),this.setupErrorHandling(a,t),this.setupClickHandler(a,s,r),t}processImageSrc(r){return this.imagePathProcessor.processImagePath(r)}createImageElement(r,e,t){let s=r.appendChild(document.createElement("img"));return s.className="imgs-grid-image",s.src=e,s.alt=t.alt,s.loading="lazy",s}addImageTitle(r,e){let t=r.appendChild(document.createElement("div"));t.className="imgs-grid-title",t.textContent=e}setupErrorHandling(r,e){r.onerror=()=>{e.classList.add("error");let t=e.appendChild(document.createElement("div"));t.className="imgs-grid-error",t.textContent="\u56FE\u7247\u52A0\u8F7D\u5931\u8D25"}}setupClickHandler(r,e,t){r.addEventListener("click",()=>{this.showImageModal(e,t)})}showImageModal(r,e){let t=document.createElement("div");t.className="imgs-modal";let s=document.createElement("div");s.className="imgs-modal-content";let a=document.createElement("button");a.className="imgs-modal-close",a.type="button",a.setAttribute("aria-label","\u5173\u95ED"),a.textContent="\xD7";let i=document.createElement("img");if(i.src=r,i.alt=e.alt,i.className="imgs-modal-image",s.appendChild(a),s.appendChild(i),e.title){let l=document.createElement("div");l.className="imgs-modal-title",l.textContent=e.title,s.appendChild(l)}t.appendChild(s),document.body.appendChild(t);let n=()=>{document.body.removeChild(t)};a.addEventListener("click",n),t.addEventListener("click",l=>{l.target===t&&n()})}},A=o=>new b(o);var H=class{constructor(r){this.app=r;this.imagePathProcessor=p(r)}async renderHtml(r,e){try{r.empty(),r.addClass("html-viewer-content");let t=this.preprocessHtmlContent(e),a=new DOMParser().parseFromString(t,"text/html"),i=Array.from(a.body.children);for(let n of i)r.appendChild(n.cloneNode(!0));await this.postProcessHtmlElements(r)}catch(t){console.error("HTML\u6E32\u67D3\u5931\u8D25:",t);let s=t instanceof Error?t.message:String(t);this.showError(r,`HTML\u6E32\u67D3\u5931\u8D25: ${s}`)}}preprocessHtmlContent(r){let e=/\.(jpg|jpeg|png|gif|bmp|webp|svg|mp4|webm|ogg|avi|mov|wmv|flv|mkv|m4v|3gp|mp3|wav|aac|flac|m4a)$/i;return r=r.replace(/(src|poster)=(["'])([^"']*?)\2/gi,(t,s,a,i)=>{if(e.test(i)){let n=this.imagePathProcessor.processImagePath(i);return`${s}=${a}${n}${a}`}return t}),r}async postProcessHtmlElements(r){r.querySelectorAll("img").forEach(t=>{t.addEventListener("error",()=>{this.showImageError(t,"\u56FE\u7247\u52A0\u8F7D\u5931\u8D25")}),t.addEventListener("load",()=>{t.setAttribute("data-loaded","true")})})}showError(r,e){r.empty();let t=r.createEl("div",{cls:"html-viewer-error",text:e})}showImageError(r,e){let t=document.createElement("div");t.className="image-load-error",t.textContent=e,r.parentNode&&r.parentNode.insertBefore(t,r.nextSibling)}};function R(o){return new H(o)}var d=require("obsidian"),y=class extends d.Modal{constructor(e,t,s,a,i,n){super(e);this.title=t,this.message=s,this.confirmText=a,this.cancelText=i,this.resolve=n}onOpen(){let{contentEl:e,titleEl:t}=this;t.setText(this.title),e.empty(),e.createEl("p",{cls:"card-viewer-settings-message"}).setText(this.message);let a=e.createEl("div",{cls:"card-viewer-settings-button-container"}),i=a.createEl("button");i.setText(this.cancelText),i.onclick=()=>{this.close(),this.resolve(!1)};let n=a.createEl("button");n.setText(this.confirmText),n.addClass("mod-cta"),n.onclick=()=>{this.close(),this.resolve(!0)}}onClose(){let{contentEl:e}=this;e.empty()}},h=class extends d.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Card Viewer \u8BBE\u7F6E"}),new d.Setting(e).setName("\u542F\u7528 HTML \u89E3\u6790").setDesc("\u662F\u5426\u542F\u7528 HTML \u4EE3\u7801\u5757\u7684\u89E3\u6790\u548C\u6E32\u67D3\u529F\u80FD").addToggle(t=>t.setValue(this.plugin.settings.enableHtmlParsing).onChange(async s=>{if(!s&&this.plugin.settings.enableHtmlParsing)if(await this.showConfirmDialog("\u786E\u8BA4\u7981\u7528 HTML \u89E3\u6790",`\u7981\u7528 HTML \u89E3\u6790\u529F\u80FD\u9700\u8981\u91CD\u542F\u63D2\u4EF6\u624D\u80FD\u5B8C\u5168\u751F\u6548\u3002

\u662F\u5426\u786E\u8BA4\u7981\u7528\u5E76\u7ACB\u5373\u91CD\u542F\u63D2\u4EF6\uFF1F`,"\u786E\u8BA4\u5E76\u91CD\u542F","\u53D6\u6D88"))this.plugin.settings.enableHtmlParsing=s,await this.plugin.saveSettings(),new d.Notice("HTML\u89E3\u6790\u5DF2\u7981\u7528\uFF0C\u6B63\u5728\u91CD\u542F\u63D2\u4EF6..."),await this.restartPlugin();else{t.setValue(!0);return}else this.plugin.settings.enableHtmlParsing=s,await this.plugin.saveSettings(),this.plugin.updateHtmlProcessor(),s&&new d.Notice("HTML\u89E3\u6790\u5DF2\u542F\u7528")}))}async showConfirmDialog(e,t,s,a){return new Promise(i=>{new y(this.app,e,t,s,a,i).open()})}async restartPlugin(){let e=this.plugin.manifest.id,t=this.app.plugins;try{await t.disablePlugin(e),await new Promise(s=>setTimeout(s,100)),await t.enablePlugin(e),setTimeout(()=>{try{t.plugins[e]?(this.app.setting.open(),this.app.setting.openTabById(e),new d.Notice("\u63D2\u4EF6\u91CD\u542F\u5B8C\u6210\uFF0C\u8BBE\u7F6E\u9875\u9762\u5DF2\u91CD\u65B0\u6253\u5F00")):new d.Notice("\u63D2\u4EF6\u91CD\u542F\u5B8C\u6210")}catch(s){console.error("Failed to reopen settings:",s),new d.Notice("\u63D2\u4EF6\u91CD\u542F\u5B8C\u6210")}},200)}catch(s){new d.Notice("\u63D2\u4EF6\u91CD\u542F\u5931\u8D25\uFF0C\u8BF7\u624B\u52A8\u91CD\u542F"),console.error("Plugin restart failed:",s)}}};var E=class extends S.Plugin{constructor(e,t){super(e,t);this.registeredEvents=[];this.htmlProcessorRegistered=!1;this.settings=v;this.registeredEvents=[],this.errorHandler=T()}async onload(){try{if(await this.loadSettings(),!this.validateApiCompatibility())return;this.initializeRenderers(),this.setupUserInterface(),await this.registerAllProcessors()}catch(e){this.errorHandler(e,"onload")}}onunload(){this.cleanup()}validateApiCompatibility(){var e;return(e=this.app)!=null&&e.workspace?typeof this.registerMarkdownCodeBlockProcessor!="function"?(console.warn("CardViewer: Code block processor API not available"),!1):!0:(console.warn("CardViewer: Workspace API not available"),!1)}initializeRenderers(){this.cardRenderer=k(this.app),this.imgsRenderer=A(this.app),this.htmlRenderer=R(this.app)}setupUserInterface(){this.addSettingTab(new h(this.app,this))}async registerAllProcessors(){let e=[{name:"Card Processors",fn:()=>this.registerCardProcessors()},{name:"HTML Processor",fn:()=>this.registerHtmlProcessor()},{name:"Post Processor",fn:()=>this.registerPostProcessor()}];for(let t of e)await M(t.fn,this.errorHandler,t.name)}registerCardProcessors(){["movie","tv","book","music"].forEach(t=>{this.registerMarkdownCodeBlockProcessor(`card-${t}`,this.createCardProcessor(t))})}createCardProcessor(e){return async(t,s,a)=>{try{await this.cardRenderer.renderCard(e,t,s,a)}catch(i){this.renderError(s,`\u6E32\u67D3${e}\u5361\u7247\u5931\u8D25`,i instanceof Error?i:new Error(String(i)))}}}registerHtmlProcessor(){this.settings.enableHtmlParsing&&!this.htmlProcessorRegistered&&(this.registerMarkdownCodeBlockProcessor("html",this.createHtmlProcessor()),this.htmlProcessorRegistered=!0)}createHtmlProcessor(){return(e,t,s)=>{try{this.renderHtmlBlock(e,t)}catch(a){this.renderError(t,"HTML\u6E32\u67D3\u5931\u8D25",a instanceof Error?a:new Error(String(a)))}}}updateHtmlProcessor(){var e;this.settings.enableHtmlParsing&&!this.htmlProcessorRegistered&&this.registerHtmlProcessor(),(e=this.app.workspace)==null||e.trigger("layout-change")}renderHtmlBlock(e,t){let s=e.trim(),a=this.createHtmlContainer(t),i=this.createContentArea(a);this.isEmptyHtmlContent(s)?this.renderEmptyContent(i):this.htmlRenderer.renderHtml(i,s)}createHtmlContainer(e){let t=e.createEl("div",{cls:"html-viewer-container"});return t.createEl("div",{cls:"html-viewer-header"}).createEl("span",{text:"HTML",cls:"html-viewer-type"}),t}createContentArea(e){return e.createEl("div",{cls:"html-viewer-content"})}renderEmptyContent(e){e.createEl("div",{cls:"html-viewer-placeholder",text:"\u7A7A\u7684HTML\u5185\u5BB9"})}isEmptyHtmlContent(e){if(e.length===0)return!0;let t="img|video|audio|source|track|embed|object|iframe|canvas|svg|picture";return[new RegExp(`^\\s*<(?!(${t})\\b)\\w+(?:\\s+(?!style|class|id)[^=]*(?:="[^"]*")?)*>\\s*</(?!(${t})\\b)\\w+>\\s*$`,"i"),new RegExp(`^\\s*<(?!(${t})\\b)\\w+(?:\\s+(?!style|class|id)[^=]*(?:="[^"]*")?)*\\/>\\s*$`,"i")].some(a=>a.test(e)&&!/\b(?:style|class|id)\s*=/.test(e))}registerPostProcessor(){this.registerMarkdownPostProcessor(async(e,t)=>{try{await Promise.all([this.processCardBlocks(e,t),this.processImgsBlocks(e,t)])}catch(s){console.warn("CardViewer: Post processor error:",s)}})}async processCardBlocks(e,t){let s=e.querySelectorAll('pre > code[class*="language-card"]');for(let a of Array.from(s)){let i=a,n=this.extractCardType(i.className);n&&await this.processCardBlock(i,n,t)}}extractCardType(e){let t=e.match(/language-card-([a-z]+)/);return t?t[1]:null}async processCardBlock(e,t,s){let a=e.textContent||"",i=e.parentElement;if(!(i!=null&&i.parentNode))return;let n=document.createElement("div");await this.cardRenderer.renderCard(t,a,n,s),i.parentNode.replaceChild(n,i)}async processImgsBlocks(e,t){let s=e.querySelectorAll('pre > code[class*="language-imgs"]');for(let a of Array.from(s))await this.processImgsBlock(a,t)}async processImgsBlock(e,t){let s=e.textContent||"",a=e.parentElement;if(!(a!=null&&a.parentNode))return;let i=document.createElement("div");i.className="imgs-grid-container",await this.imgsRenderer.renderImgsGrid(s,i,t),a.parentNode.replaceChild(i,a)}renderError(e,t,s){e&&typeof e.createEl=="function"&&e.createEl("div",{text:`${t}: ${s.message}`,cls:"card-viewer-error"})}cleanup(){try{this.htmlProcessorRegistered=!1,this.cleanupEventListeners()}catch(e){console.warn("CardViewer: Cleanup error:",e)}}cleanupEventListeners(){var e;(e=this.registeredEvents)!=null&&e.length&&(this.registeredEvents.forEach(t=>{var s;try{(s=t.detach)==null||s.call(t)}catch(a){}}),this.registeredEvents=[])}async loadSettings(){try{let e=await this.loadData();this.settings=Object.assign({},v,e)}catch(e){console.warn("CardViewer: Failed to load settings:",e),this.settings={...v}}}async saveSettings(){try{await this.saveData(this.settings)}catch(e){throw console.error("CardViewer: Failed to save settings:",e),e}}};
